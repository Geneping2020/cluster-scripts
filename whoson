#!/bin/bash

squeue --noheader -o "%u %T" | sort | uniq -c | awk '
BEGIN{
    printf "sid,name,jobs(running/pending/total)\n";
    prevname="";
} {
    cmd="finger -s \""$2"\" | awk '\'' NR > 1 {print $2, $3} '\'' ";
    cmd|getline name; 
    if (NR==1) 
    {
	prevname=name;
    }
    if (name==prevname) 
    { 
        if ($3=="PENDING")
        {
            pending_count=$1
        }
        else if ($3=="RUNNING")
        {
            running_count=$1
        }
    } 
    else 
    {
        printf "%s,%s,%s/%s/%s\n", $2, prevname, running_count,pending_count,running_count+pending_count; 
        running_count=0;
        pending_count=0;
        prevname=name;
	if ($3=="PENDING")
        {
            pending_count=$1
        }
	else if ($3=="RUNNING")
        {
            running_count=$1
        }

    }
    close(cmd)
}' | column -s',' -t
